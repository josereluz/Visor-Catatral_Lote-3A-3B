* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
}

:root{
    --panel-width: 280px;
    --panel-collapsed-visible: 56px;
}

.container {
    position: relative;
    width: 100vw;
    height: 100vh;
    display: flex;
}

/* Panel de capas */
.panel-capas {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: var(--panel-width);
    background: white;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    transition: transform 0.3s ease;
    overflow-y: auto;
}

.panel-capas.collapsed {
    transform: translateX(calc(-1 * (var(--panel-width) - var(--panel-collapsed-visible))));
}

.panel-capas.collapsed .panel-content{
    opacity: 0;
    pointer-events: none;
}

.panel-capas.collapsed .panel-header h3{
    opacity: 0;
}

.panel-capas.collapsed .panel-header{
    /* mantiene el botón visible y evita que se “pegue” */
    padding: 16px 18px;
}

.panel-header {
    position: relative;
    background: linear-gradient(135deg, #0f172a, #1f3a8a);
    color: white;
    padding: 16px 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255,255,255,0.12);
}

.panel-header h3 {
    font-size: 18px;
    font-weight: 800;
    letter-spacing: 0.3px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.25);
    /* Centrar el título del panel sin afectar el botón flotante */
    width: 100%;
    text-align: center;
    margin: 0;
    padding: 0 34px; /* reserva espacio para el botón de colapso */
}

.toggle-btn {
    position: absolute;
    
    z-index: 1200;
    right: -14px; /* sobresale para seguir visible cuando el panel está colapsado */
    top: 50%;
    transform: translateY(-50%);
    width: 34px;
    height: 34px;
    border-radius: 999px;
    background: rgba(255,255,255,0.16);
    color: #ffffff;
    border: 1px solid rgba(255,255,255,0.25);
    box-shadow: 0 6px 18px rgba(0,0,0,0.20);
    cursor: pointer;
    font-size: 16px;
    font-weight: 900;
    line-height: 32px;
    display: grid;
    place-items: center;
    transition: background 0.2s, transform 0.2s;
}

.toggle-btn:hover {
    background: rgba(255,255,255,0.24);
}

.panel-capas.collapsed .toggle-btn {
    transform: translateY(-50%) rotate(180deg);
}

.panel-content {
    padding: 20px;
}

/* Items de capas */
.capa-item {
    margin-bottom: 10px;
    padding: 8px;
    background: #f8f9fa;
    border-radius: 5px;
    transition: background 0.2s;
}

.capa-item:hover {
    background: #e9ecef;
}

.capa-item label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 14px;
}

.capa-item input[type="checkbox"] {
    margin-right: 10px;
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.capa-item span {
    color: #2c3e50;
    font-weight: 500;
}



/* Sub-opción debajo de una capa (ej: ver atributos) */
.capa-subitem {
    margin: -4px 0 10px 22px;
    padding: 6px 8px;
    background: transparent;
    border-left: 3px solid rgba(44,62,80,0.18);
}
.capa-subitem label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 12.5px;
    opacity: 0.95;
}
.capa-subitem input[type="checkbox"] {
    margin-right: 8px;
    width: 16px;
    height: 16px;
}
.capa-subitem input[type="checkbox"]:disabled + span {
    opacity: 0.55;
}
.capa-subitem span {
    color: #2c3e50;
    font-weight: 500;
}
/* Mapa */
#map {
    flex: 1;
    width: 100%;
    height: 100vh;
}

/* Estilos para el buscador */
.buscador-section {
    margin-bottom: 20px;
}


/* Select del buscador */
.buscador-section select{
  cursor: pointer;
  background: #fff;
  appearance: none;
}
#btn-search:hover {
    background: #2980b9;
}

#btn-search:active {
    transform: scale(0.98);
}

.control-capas {
    margin-top: 20px;
}

/* Control de Norte */
.leaflet-control.north-control {
    background: rgba(255, 255, 255, 0.95);
    width: 42px;
    height: 42px;
    border-radius: 50%;
    border: 2px solid #2c3e50;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.25);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: default;
}

.leaflet-control.north-control .north-icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.leaflet-control.north-control .north-icon::before {
    content: "";
    border-left: 7px solid transparent;
    border-right: 7px solid transparent;
    border-bottom: 12px solid #e74c3c;
}

.leaflet-control.north-control .north-letter {
    font-size: 11px;
    font-weight: 700;
    color: #2c3e50;
}

/* Popup de construcción */
.popup-construccion h4 {
    margin: 0 0 6px 0;
    font-size: 13px;
    color: #2c3e50;
}

.popup-construccion table {
    width: 100%;
    border-collapse: collapse;
}

.popup-construccion td {
    padding: 2px 4px;
    font-size: 11px;
    border-bottom: 1px solid #f0f0f0;
}

.popup-construccion td.label {
    font-weight: 600;
    color: #34495e;
    white-space: nowrap;
}

/* Responsive */
@media (max-width: 768px) {
    :root{ --panel-width: 250px; --panel-collapsed-visible: 40px; }
.panel-header h3 {
        font-size: 16px;
    }
    
    .capa-item label {
        font-size: 13px;
    }
}

@media (max-width: 480px) {
    :root{ --panel-width: 220px; --panel-collapsed-visible: 40px; }
}



/* ===== Layout del mapa ===== */
#map{
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: var(--panel-width);
    width: auto;
    height: auto;
}
.panel-capas.collapsed ~ #map{
    left: var(--panel-collapsed-visible);
}
/* ===== UI refinado ===== */
.section-title{
    margin: 0 0 10px 0;
    color: #2c3e50;
    font-size: 14px;
}

.sep{
    border: none;
    border-top: 1px solid #eee;
    margin: 16px 0;
}

.panel-north{
    width: 38px;
    height: 38px;
    border-radius: 10px;
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.28);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    margin-left: auto;
}

.panel-north .n-letter{
    font-weight: 800;
    font-size: 12px;
    line-height: 1;
}

.panel-north .n-arrow{
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid rgba(255,255,255,0.95);
    margin-top: 2px;
}

/* Grupos */
.grupo{
    border: 1px solid #e6e6e6;
    border-radius: 6px;
    overflow: hidden;
    background: #fff;
}
.grupo-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding: 10px;
    background: #f7f9fb;
    cursor:pointer;
    user-select:none;
    font-size: 13px;
    color: #2c3e50;
    font-weight: 650;
    border-bottom: 1px solid #eee;
}
.grupo-body{
    padding: 8px;
}
.grupo-body.closed{ display:none; }
.arrow{ color:#7f8c8d; }

/* Mini-grupos para opciones de capa (e.g. Ver atributos) */
.mini-grupo{
    border: none;
    border-radius: 0;
    overflow: visible;
    background: transparent;
    margin-top: 0;
}
.mini-grupo .mini-header{
    padding: 8px;
    background: #f8f9fa;
    border-radius: 5px;
    border-bottom: none;
    font-size: 14px;
    font-weight: 500;
}
.mini-grupo .mini-header:hover{ background:#e9ecef; }
.mini-grupo .grupo-body{ padding: 0; }
.mini-grupo .capa-main{
    display:flex;
    align-items:center;
    cursor:pointer;
    font-size: 14px;
    font-weight: 500;
}
.mini-grupo .capa-main input[type="checkbox"]{
    margin-right: 10px;
    width: 18px;
    height: 18px;
}


/* Pisos */
.pisos-box{
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px dashed #e2e2e2;
}
.pisos-title{
    font-size: 12px;
    color: #7f8c8d;
    margin-bottom: 8px;
}
.pisos-container{
    display:flex;
    flex-wrap:wrap;
    gap: 6px;
}
.pisos-hint{ font-size: 12px; color:#7f8c8d; }

.piso-pill{
    display:inline-flex;
    align-items:center;
    gap: 7px;
    padding: 6px 9px;
    border: 1px solid #ddd;
    border-radius: 999px;
    background: #fafafa;
    font-size: 12px;
    cursor:pointer;
}

/* Nota */
.legend-box .legend-note{
    margin-top: 12px;
    padding: 10px;
    border: 1px dashed #e2e2e2;
    border-radius: 6px;
    background: #fafafa;
    font-size: 12px;
}
.legend-note .muted{ color:#7f8c8d; }

.legend-empty{ padding: 10px 12px; font-size: 12px; color: #64748b; }
.legend-box .muted{ color:#7f8c8d; font-size: 11px; }

/* Basemap box con Zoom adentro */
.leaflet-control.basemap-box{
    background: rgba(255,255,255,0.96);
    border: 1px solid #dcdcdc;
    border-radius: 8px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    padding: 10px;
    font-size: 12px;
    color: #2c3e50;
    min-width: 160px;
}
.basemap-box .title{
    font-weight: 700;
    margin-bottom: 6px;
}
.basemap-box label{
    display:flex;
    align-items:center;
    gap: 8px;
    margin: 4px 0;
    cursor:pointer;
}
.basemap-box .zoom-row{
    display:flex;
    gap: 8px;
    margin-top: 8px;
}
.basemap-box .zbtn{
    flex: 1;
    border: 1px solid #dcdcdc;
    background: #ffffff;
    border-radius: 6px;
    height: 32px;
    cursor:pointer;
    font-size: 18px;
    font-weight: 800;
    color:#2c3e50;
}
.basemap-box .zbtn:hover{ background: #f2f4f7; }

/* Etiquetas */
.leaflet-tooltip.lbl-manzana,
.leaflet-tooltip.lbl-lote{
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    padding: 0 !important;
}

.leaflet-tooltip.lbl-manzana{
    color: #ff00ff;
    font-weight: 900;
    font-size: 16px;
    text-shadow: 
        -1px -1px 0 rgba(255, 255, 0, 0.85),
         1px -1px 0 rgba(255, 255, 0, 0.85),
        -1px  1px 0 rgba(255, 255, 0, 0.85),
         1px  1px 0 rgba(255, 255, 0, 0.85),
         0   0   4px rgba(255, 255, 0, 0.75);
}

.leaflet-tooltip.lbl-lote{
    color: #000;
    font-weight: 900;
    font-size: 11px;
    text-shadow: 
        -1px -1px 0 #fff,
         1px -1px 0 #fff,
        -1px  1px 0 #fff,
         1px  1px 0 #fff,
         0   0   3px rgba(255, 255, 255, 0.95);
}

.search-result{
    margin-top: 8px;
    font-size: 12px;
    color: #2c3e50;
}
.hint{
    margin-top: 10px;
    font-size: 11px;
    color: #7f8c8d;
    line-height: 1.3;
}

/* Popup */
.popup-attrs h4{
    margin: 0 0 6px 0;
    font-size: 13px;
    color: #2c3e50;
}
.popup-attrs table{
    width:100%;
    border-collapse: collapse;
}
.popup-attrs td{
    padding: 3px 6px;
    font-size: 12px;
    border-bottom: 1px solid #eee;
}
.popup-attrs td.key{ color:#7f8c8d; width: 40%; }



/* ===== v9 overrides ===== */

/* Mantener layout del visor */
#map{
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: var(--panel-width);
    width: auto;
    height: auto;
    transition: left 0.3s ease;
}
.panel-capas.collapsed ~ #map{ left: var(--panel-collapsed-visible); }

.sep{ border: none; border-top: 1px solid #eee; margin: 16px 0; }
.section-title{ margin: 0 0 10px 0; color:#2c3e50; font-size:14px; }
.search-result{ margin-top:8px; font-size:12px; color:#2c3e50; }
.hint{ margin-top:10px; font-size:11px; color:#7f8c8d; line-height:1.3; }

/* Basemap box sin botones de zoom */
.basemap-box .zoom-row, .basemap-box .zbtn{ display:none !important; }

/* Etiquetas */
.leaflet-tooltip.lbl-manzana, .leaflet-tooltip.lbl-lote, .leaflet-tooltip.lbl-puerta{
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    padding: 0 !important;
}
.leaflet-tooltip.lbl-manzana{
    color:#ff00ff; font-weight:900; font-size:16px;
    text-shadow: 
        -1px -1px 0 rgba(255, 255, 0, 0.85),
         1px -1px 0 rgba(255, 255, 0, 0.85),
        -1px  1px 0 rgba(255, 255, 0, 0.85),
         1px  1px 0 rgba(255, 255, 0, 0.85),
         0   0   4px rgba(255, 255, 0, 0.75);
}
.leaflet-tooltip.lbl-lote{
    color:#000; font-weight:900; font-size:11px;
    text-shadow: 
        -1px -1px 0 #fff,
         1px -1px 0 #fff,
        -1px  1px 0 #fff,
         1px  1px 0 #fff,
         0   0   3px rgba(255, 255, 255, 0.95);
}
.leaflet-tooltip.lbl-puerta{
    color:#000 !important;
    font-weight:900;
    font-size:12px;
    text-shadow:
        -1px -1px 0 rgba(0, 180, 90, 0.95),
         1px -1px 0 rgba(0, 180, 90, 0.95),
        -1px  1px 0 rgba(0, 180, 90, 0.95),
         1px  1px 0 rgba(0, 180, 90, 0.95),
         0   0   6px rgba(0, 180, 90, 0.65);
}

/* Popups */
.popup-attrs h4{ margin:0 0 6px 0; font-size:13px; color:#2c3e50; }
.popup-attrs table{ width:100%; border-collapse:collapse; }
.popup-attrs td{ padding:3px 6px; font-size:12px; border-bottom:1px solid #eee; }
.popup-attrs td.key{ color:#7f8c8d; width:40%; }



/* v13: Buscador ordenado */
.buscador-section label{
  display:block;
  margin-top:10px;
  margin-bottom:6px;
}
.buscador-section input,
.buscador-section select{
  display:block;
  width:100%;
  box-sizing:border-box;
}



/* v14: UI más estética (sin íconos) */
.section-title{
  font-weight: 800;
  letter-spacing: 0.2px;
  font-size: 14px;
  color: #1f2d3d;
}
.buscador-section label{
  font-weight: 800;
  color: #1f2d3d;
}
.buscador-section input,
.buscador-section select{
  border: 1px solid #d9e2ec;
  border-radius: 8px;
  padding: 10px 12px;
  font-size: 13px;
  outline: none;
  transition: box-shadow .15s ease, border-color .15s ease;
}
.buscador-section input:focus,
.buscador-section select:focus{
  border-color: #2d9cdb;
  box-shadow: 0 0 0 3px rgba(45,156,219,.15);
}
#btn-search{
  margin-top: 12px;
  width: 100%;
  border: none;
  border-radius: 10px;
  padding: 10px 12px;
  font-weight: 800;
  font-size: 13px;
  cursor: pointer;
  background: #2d9cdb;
  color: #fff;
  box-shadow: 0 6px 14px rgba(45,156,219,.25);
  transition: transform .08s ease, filter .15s ease;
}
#btn-search:hover{ filter: brightness(0.98); }
#btn-search:active{ transform: translateY(1px); }
.search-result{
  margin-top: 10px;
  font-size: 12px;
  color: #2c3e50;
}

/* Encabezados de acordeón sin iconos */
.grupo-header span:first-child{
  font-weight: 800;
  color: #1f2d3d;
}

/* v15: reducir espacio entre secciones */
.sep{ margin: 10px 0 !important; }
.buscador-section{ padding-bottom: 6px !important; }
.control-capas{ padding-top: 0 !important; }

/* v18: reducir un poco más el espacio buscador <-> capas */
.sep{ margin: 4px 0 !important; }
.buscador-section{ padding-bottom: 0 !important; }
#btn-search{ margin-bottom: 4px !important; }

/* Quitar resaltado azul de selección al hacer click */
.leaflet-interactive {
    outline: none !important;
}

.leaflet-interactive:focus {
    outline: none !important;
}

/* Quitar el box de selección azul de Leaflet */
.leaflet-container {
    outline: none !important;
}

.leaflet-container:focus {
    outline: none !important;
}

/* Deshabilitar selección de texto */
.leaflet-container {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* Control de medición */
.measure-control {
    background: white;
    border-radius: 4px;
    box-shadow: 0 1px 5px rgba(0,0,0,0.4);
    margin-bottom: 10px;
}

.measure-btn {
    background: white;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 18px;
    border-radius: 4px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    min-height: 40px;
    color: #333;
}

.measure-btn svg {
    width: 20px;
    height: 20px;
}

.measure-btn:hover {
    background: #f4f4f4;
}

.measure-btn:active {
    transform: scale(0.95);
}

.leaflet-popup.measure-popup .leaflet-popup-content-wrapper {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 3px 14px rgba(0,0,0,0.4);
}

.leaflet-popup.measure-popup .leaflet-popup-content {
    margin: 13px 19px;
}


/* Basemap colapsable */
.basemap-box .basemap-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
    margin-bottom: 6px;
}
.basemap-box .basemap-header .title{
    margin: 0;
    font-weight: 700;
}
.basemap-box .basemap-toggle{
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 14px;
    line-height: 1;
    padding: 4px 6px;
    border-radius: 6px;
    color: inherit;
}
.basemap-box .basemap-toggle:hover{
    background: #f2f4f7;
}

/* Colapso horizontal (hacia la derecha) */
.leaflet-control.basemap-box{
    width: 172px;
    min-width: 0 !important;
    overflow: hidden;
    transition: width .18s ease, padding .18s ease;
}
.basemap-box.collapsed{
    width: 38px;
    padding: 8px 6px;
}
.basemap-box.collapsed .basemap-options{ display:none; }
.basemap-box.collapsed .title{ display:none; }
.basemap-box.collapsed .basemap-header{ margin-bottom: 0; justify-content: center; }


/* Controles esquina superior izquierda (Zoom + Norte + Ayuda) */
.leaflet-control.corner-control{
    display: grid;
    grid-template-columns: auto auto;
    grid-auto-rows: auto;
    gap: 8px;
}

.corner-control .corner-zoom{ grid-column: 1; grid-row: 1; }
.corner-control .corner-north{ grid-column: 2; grid-row: 1; }
.corner-control .corner-help{ grid-column: 1; grid-row: 2; position: relative; }
.corner-control .corner-refresh{ grid-column: 1; grid-row: 3; }
.corner-control .corner-locate{ grid-column: 1; grid-row: 4; }

.corner-control .leaflet-bar{
    border-radius: 10px;
    overflow: visible; /* para permitir el popover de ayuda */
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}

.corner-control .corner-refresh a{
    font-size: 18px;
    line-height: 26px;
    text-align: center;
}
.corner-control .corner-zoom.leaflet-bar,
.corner-control .corner-north.leaflet-bar{
    overflow: hidden;
}

.corner-control .corner-zoom a{
    width: 34px;
    height: 34px;
    line-height: 34px;
    font-weight: 900;
    font-size: 18px;
    color: #0f172a;
    background: rgba(255,255,255,0.98);
}

.corner-control .corner-north{
    width: 38px;
    height: 38px;
    display:flex;
    align-items:center;
    justify-content:center;
    background: rgba(255,255,255,0.98);
    border: 1px solid rgba(0,0,0,0.14);
    border-radius: 999px;
    backdrop-filter: blur(2px);
    color: #0f172a;
}

.corner-control .corner-help a{
    display:block;
    width: 34px;
    height: 34px;
    line-height: 34px;
    text-align:center;
    font-weight: 900;
    font-size: 18px;
    color: #0f172a;
    background: rgba(255,255,255,0.98);
}

.corner-control .help-popover{
    position: absolute;
    left: 44px;
    top: 0;
    width: 270px;
    background: rgba(255,255,255,0.98);
    border: 1px solid #dcdcdc;
    border-radius: 12px;
    box-shadow: 0 6px 22px rgba(0,0,0,0.22);
    padding: 12px;
    color: #2c3e50;
    z-index: 9999;
}
.corner-control .help-title{
    font-weight: 900;
    font-size: 13px;
    margin-bottom: 8px;
}
.corner-control .help-line{
    font-size: 12px;
    line-height: 1.35;
    margin-bottom: 6px;
}
.corner-control .help-line:last-child{ margin-bottom: 0; }

/* Medición - popup más limpio */
.leaflet-popup.measure-popup .leaflet-popup-content-wrapper{
    border-radius: 12px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.28);
}
.leaflet-popup.measure-popup .leaflet-popup-tip{
    display:none;
}
.leaflet-popup.measure-popup .leaflet-popup-content{
    margin: 12px 14px;
}
.leaflet-popup.measure-popup a.leaflet-popup-close-button{
    color: #8b8b8b;
    font-size: 18px;
    padding: 6px 8px 0 0;
}
.leaflet-popup.measure-popup a.leaflet-popup-close-button:hover{
    color: #3a3a3a;
}
.measure-card{
    text-align:center;
}
.measure-card .measure-label{
    font-size: 12px;
    font-weight: 700;
    color: #566573;
    letter-spacing: 0.2px;
    margin-bottom: 2px;
}
.measure-card .measure-value{
    font-size: 18px;
    font-weight: 900;
    color: #2c3e50;
}


.corner-north-svg{ display:block; }

/* Separación de controles Leaflet para evitar que se “peguen” al borde/panel */
#map .leaflet-top.leaflet-left,
#map .leaflet-bottom.leaflet-left{
    left: 18px;
}


/* ===== Leyenda ===== */
.leaflet-control.legend-box{
    background: rgba(255,255,255,0.96);
    border: 1px solid #dcdcdc;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.18);
    padding: 0;
    min-width: 220px;
    max-width: 280px;
    overflow: hidden;
    color: #1f2937;
    font-size: 12px;
}
.legend-box .legend-header{
    display:flex;
    align-items:center;
    justify-content: space-between;
    padding: 10px 12px;
    background: linear-gradient(135deg, rgba(15,23,42,0.06), rgba(31,58,138,0.08));
    border-bottom: 1px solid rgba(0,0,0,0.06);
}
.legend-box .legend-header .title{
    font-weight: 800;
    letter-spacing: 0.2px;
}
.legend-box .legend-toggle{
    border: 1px solid rgba(0,0,0,0.12);
    background: rgba(255,255,255,0.9);
    border-radius: 8px;
    width: 32px;
    height: 28px;
    cursor: pointer;
    font-weight: 900;
}
.legend-box .legend-body{
    padding: 10px 12px;
    max-height: 240px;
    overflow: auto;
}
.legend-box.collapsed{
    min-width: auto;
}
.legend-box.collapsed .legend-body{
    display:none;
}

.legend-box .legend-section{ margin-bottom: 10px; }
.legend-box .legend-sec-title{
    font-weight: 800;
    margin-bottom: 6px;
    color: #0f172a;
}
.legend-box .legend-row{
    display:flex;
    align-items:center;
    gap: 8px;
    padding: 2px 0;
}
.legend-box .legend-row span{ line-height: 1.2; }
.legend-box .legend-row.legend-more{ color:#6b7280; font-style: italic; padding-left: 22px; }
.legend-box .legend-note{ margin-top: 6px; font-size: 11px; color:#6b7280; }

.legend-box .lg-swatch{
    width: 14px;
    height: 14px;
    display:inline-block;
    border: 2px solid #999;
    border-radius: 4px;
    box-sizing: border-box;
    flex: 0 0 auto;
}
.legend-box .lg-line{ background: transparent; }
.legend-box .lg-poly{ opacity: 1; }
.legend-box .lg-point{ border-radius: 999px; }

/* Asegurar que los popups queden por encima de cualquier resaltado */
.leaflet-popup-pane { z-index: 1200 !important; }


/* --- Mejor contraste en la leyenda (colores sólidos y visibles) --- */
#legendBox .swatch, #legendBox .legend-swatch, #legendBox .legend-dot, #legendBox .legend-color {
  opacity: 1 !important;
  filter: none !important;
}

#legendBox .swatch, #legendBox .legend-swatch, #legendBox .legend-color {
  border: 2px solid rgba(17, 24, 39, 0.55);
  box-sizing: border-box;
}

#legendBox .legend-dot {
  border: 2px solid rgba(17, 24, 39, 0.55);
  box-sizing: border-box;
}


/* --- Leyenda: permitir scroll con rueda sin hacer zoom del mapa --- */
.legend-box .legend-body{
  max-height: 42vh;
  overflow-y: auto;
  overscroll-behavior: contain;
}


/* --- Leyenda: colores sólidos (sin transparencia) para distinguir tipos --- */
.legend-box .lg-swatch{
  border-color: rgba(17, 24, 39, 0.55);
}
.legend-box .lg-poly{
  opacity: 1;
}


/* --- Leyenda: ocultar "Campo: tipo" --- */
.legend-box .legend-field{
  display: none !important;
}


/* === Responsive (móvil) === */
@media (max-width: 768px) {
  :root{
    --panel-width: min(86vw, 340px);
    --panel-collapsed-visible: 52px;
  }

  html, body{
    height: 100%;
    overflow: hidden;
  }

  .container{
    width: 100vw;
    height: 100dvh;
  }

  /* Panel */
  .panel-capas{
    width: var(--panel-width);
    box-shadow: 2px 0 16px rgba(0,0,0,0.18);
  }

  .panel-header{
    padding: 14px 14px;
  }

  .panel-header h3{
    font-size: 16px;
    letter-spacing: 0.2px;
  }

  .toggle-btn{
    width: 40px;
    height: 34px;
    font-size: 18px;
    border-radius: 10px;
  }

  .panel-content{
    padding: 14px 14px 18px 14px;
  }

  .section-title{
    font-size: 14px;
  }

  label{
    font-size: 13px;
  }

  /* Evita zoom automático en iOS (inputs <16px) */
  input, select, button{
    font-size: 16px;
  }

  #btn-search{
    padding: 12px 12px;
    border-radius: 10px;
  }

  .grupo-header{
    padding: 12px 12px;
    font-size: 14px;
  }

  .capa-item label{
    padding: 10px 6px;
  }

  .pisos-container{
    gap: 10px;
  }

  /* Controles del mapa: un poco más grandes */
  .leaflet-control-zoom a{
    width: 34px !important;
    height: 34px !important;
    line-height: 34px !important;
    font-size: 18px !important;
  }

  .leaflet-control.basemap-box{
    min-width: 145px;
    padding: 8px 10px;
    font-size: 12px;
    border-radius: 10px;
  }

  .leaflet-control.legend-box{
    min-width: 200px;
    max-width: 260px;
  }
  .legend-box .legend-body{
    max-height: 45vh;
  }

  /* Escala/medición con un poquito de margen */
  .leaflet-control-scale{
    margin-bottom: 10px !important;
  }
}

@media (max-width: 420px) {
  :root{
    --panel-width: min(88vw, 320px);
    --panel-collapsed-visible: 50px;
  }
  .leaflet-control.legend-box{ min-width: 190px; }
}


/* Medición (distancia/área) - botones apilados */
.measure-control{ display:flex; flex-direction:column; overflow:hidden; }
.measure-btn + .measure-btn{ border-top: 1px solid rgba(0,0,0,0.10); border-radius: 0; }
.measure-btn.is-active{ background:#e74c3c; color:#fff; }
.measure-btn.is-active:hover{ background:#d6453a; }

.corner-control .corner-locate a{
  display:block;
  width:34px;
  height:34px;
  line-height:34px;
  text-align:center;
  font-size:18px;
  color:#0f172a;
  background: rgba(255,255,255,0.98);
}


.measure-btn{ display:flex; align-items:center; justify-content:center; gap:0; padding:8px; width:40px; }
.measure-btn svg{ flex:0 0 auto; }
/* Solo íconos (sin texto) */
.measure-text{ display:none !important; }
.measure-control{ min-width: auto; }

/* ===== Modal selector de distrito ===== */
.district-modal{
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.45);
  z-index: 9999;
  padding: 16px;
}
.district-modal.open{ display:flex; }

.district-modal-card{
  width: min(520px, 100%);
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 12px 40px rgba(0,0,0,.25);
  padding: 18px 18px 16px;
  border: 1px solid rgba(0,0,0,.08);
}

.district-modal-card h2{
  margin: 0 0 6px;
  font-size: 18px;
  font-weight: 700;
  text-align: center;
}
.district-modal-sub{
  margin: 0 0 14px;
  text-align: center;
  font-size: 13px;
  opacity: .85;
}

.district-modal-actions{
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
}

.district-btn{
  text-align: left;
  border: 1px solid rgba(0,0,0,.12);
  border-radius: 12px;
  padding: 14px 14px;
  background: #f7f7f7;
  cursor: pointer;
  transition: transform .08s ease, box-shadow .08s ease, background .08s ease;
}
.district-btn:hover{
  background: #ffffff;
  box-shadow: 0 8px 22px rgba(0,0,0,.12);
  transform: translateY(-1px);
}
.district-btn:active{ transform: translateY(0px); }

.district-btn-title{
  display:block;
  font-weight: 800;
  font-size: 16px;
}
.district-btn-sub{
  display:block;
  margin-top: 2px;
  font-size: 12px;
  opacity: .85;
}

@media (min-width: 520px){
  .district-modal-actions{
    grid-template-columns: 1fr 1fr;
  }
  .district-btn{
    text-align: center;
  }
}
